<Window x:Class="chatbot.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:chatbot"
    Title="Chatbot" Height="700" Width="800"
    WindowStartupLocation="CenterScreen"
    Background="#F0F0F0">
    <!-- Root Grid for the entire window -->
    <Grid>
        <!-- Toggle History Button -->
        <!-- This button allows the user to toggle the visibility of the history panel -->
        <Button x:Name="ToggleHistoryButton"
            Content="Hide History"
            Background="#E1E1E1"
            Foreground="#000000"
            FontWeight="Normal"
            FontSize="14"
            Padding="8,4"
            Margin="24,24,0,0"
            BorderThickness="1"
            BorderBrush="#A0A0A0"
            Cursor="Hand"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Click="ToggleHistoryButton_Click"
            Panel.ZIndex="100" />

        <!-- Color Theme Button -->
        <Button x:Name="ColorThemeButton"
            Content="🎨 Colors"
            Background="#E1E1E1"
            Foreground="#000000"
            FontWeight="Normal"
            FontSize="14"
            Padding="8,4"
            Margin="150,24,0,0"
            BorderThickness="1"
            BorderBrush="#A0A0A0"
            Cursor="Hand"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Click="ColorThemeButton_Click"
            Panel.ZIndex="100" />

        <!-- Document Management Button -->
        <Button x:Name="DocumentManagementButton"
            Content="📄 Documents"
            Background="#E1E1E1"
            Foreground="#000000"
            FontWeight="Normal"
            FontSize="14"
            Padding="8,4"
            Margin="270,24,0,0"
            BorderThickness="1"
            BorderBrush="#A0A0A0"
            Cursor="Hand"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Click="DocumentManagementButton_Click"
            Panel.ZIndex="100" />

        <!-- Color Selection Panel -->
        <local:ColorSelectionControl x:Name="ColorSelectionPanel"
                                   Margin="150,60,0,0"
                                   HorizontalAlignment="Left"
                                   VerticalAlignment="Top"
                                   Visibility="Collapsed"
                                   Panel.ZIndex="200"
                                   ColorThemeSelected="ColorSelectionPanel_ColorThemeSelected"
                                   ColorPanelCloseRequested="ColorSelectionPanel_ColorPanelCloseRequested" />

        <!-- Document Management Panel -->
        <Border x:Name="DocumentManagementPanel"
                Background="#F8F8F8"
                BorderBrush="#A0A0A0"
                BorderThickness="1"
                CornerRadius="5"
                Margin="270,60,0,0"
                Padding="16"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Visibility="Collapsed"
                Panel.ZIndex="200"
                Width="400"
                MaxHeight="500">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Title and Close Button -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="Document Management" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               VerticalAlignment="Center" />
                    <Button x:Name="CloseDocumentPanelButton"
                            Content="❌"
                            Background="Transparent"
                            BorderThickness="0"
                            FontSize="16"
                            Cursor="Hand"
                            HorizontalAlignment="Right"
                            Click="CloseDocumentPanelButton_Click" />
                </Grid>

                <!-- URL Input Section -->
                <TextBlock Grid.Row="1" 
                           Text="Add Document from URL:" 
                           FontWeight="Bold" 
                           Margin="0,0,0,8" />
                
                <TextBox x:Name="DocumentUrlTextBox"
                         Grid.Row="2"
                         Margin="0,0,0,8"
                         Padding="8"
                         FontSize="14"
                         ToolTip="Enter Azure Blob Storage PDF URL" />

                <Button x:Name="AddDocumentButton"
                        Grid.Row="3"
                        Content="📤 Add Document"
                        Background="#4CAF50"
                        Foreground="White"
                        FontWeight="Bold"
                        Padding="12,8"
                        Margin="0,0,0,16"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="AddDocumentButton_Click" />

                <!-- Progress Section -->
                <StackPanel x:Name="ProgressSection" 
                            Grid.Row="4" 
                            Visibility="Collapsed"
                            Margin="0,0,0,16">
                    <TextBlock x:Name="ProgressStatusText" 
                               Text="Processing document..." 
                               FontStyle="Italic" 
                               Margin="0,0,0,4" />
                    <ProgressBar x:Name="DocumentProgressBar" 
                                 Height="6" 
                                 IsIndeterminate="True" />
                </StackPanel>

                <!-- Document List -->
                <ScrollViewer Grid.Row="5" 
                              VerticalScrollBarVisibility="Auto"
                              MaxHeight="200">
                    <StackPanel x:Name="DocumentListPanel">
                        <TextBlock Text="Uploaded Documents:" 
                                   FontWeight="Bold" 
                                   Margin="0,0,0,8" />
                        <ItemsControl x:Name="DocumentItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#E8F5E8" 
                                            BorderBrush="#4CAF50" 
                                            BorderThickness="1" 
                                            Margin="0,2" 
                                            Padding="8"
                                            CornerRadius="3">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding Name}" 
                                                           FontWeight="Bold" 
                                                           FontSize="12" />
                                                <TextBlock Text="{Binding UploadDate}" 
                                                           FontSize="10" 
                                                           Foreground="#666" />
                                            </StackPanel>
                                            <Button Grid.Column="1"
                                                    Content="🗑️"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    FontSize="12"
                                                    Cursor="Hand"
                                                    ToolTip="Remove document"
                                                    Click="RemoveDocumentButton_Click"
                                                    Tag="{Binding Id}" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- Status Message -->
                <TextBlock x:Name="DocumentStatusMessage" 
                           Grid.Row="6" 
                           Margin="0,8,0,0" 
                           FontSize="12" 
                           Foreground="#666" 
                           TextWrapping="Wrap" 
                           Visibility="Collapsed" />
            </Grid>
        </Border>

        <!-- Main layout grid -->
        <!-- This grid divides the window into two columns: History and Main Chat Area -->
        <Grid Margin="0,60,0,0">
            <Grid.ColumnDefinitions>
                <!-- History column -->
                <ColumnDefinition Width="*" x:Name="HistoryColumn" />
                <!-- Main chat area column -->
                <ColumnDefinition Width="2*" x:Name="MainColumn" />
            </Grid.ColumnDefinitions>

            <!-- History Panel -->
            <!-- This grid contains the history panel where previous questions are displayed -->
            <Grid Grid.Column="0" x:Name="HistoryPanelGrid">
                <local:HistoryControl x:Name="HistoryPanel" 
                                    HistoryItemSelected="HistoryPanel_HistoryItemSelected"
                                    HistoryCleared="HistoryPanel_HistoryCleared" />
            </Grid>

            <!-- Main Chat Area -->
            <!-- This section contains the main chat interface -->
            <Border Grid.Column="1" CornerRadius="0" Padding="32" Background="#F0F0F0" Margin="24" BorderBrush="#808080" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <!-- Title row -->
                        <RowDefinition Height="Auto" />
                        <!-- Input row -->
                        <RowDefinition Height="Auto" />
                        <!-- Chat display row -->
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <!-- Title for the chatbot -->
                    <TextBlock Text="AI Chatbot" FontSize="32" FontWeight="Bold"
                        Foreground="#000000"
                        Margin="0,0,0,24" HorizontalAlignment="Center" Grid.Row="0" />
                    <!-- Input area for questions -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,16">
                        <!-- Image selection area -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <Button Name="SelectImageButton"
                                Content="📷 Select Image"
                                MinHeight="35"
                                FontSize="14"
                                Background="#E1E1E1"
                                Foreground="#000000"
                                BorderThickness="1"
                                BorderBrush="#A0A0A0"
                                Padding="12,0"
                                Cursor="Hand"
                                Click="SelectImageButton_Click"
                                Margin="0,0,8,0" />
                            <Button Name="ClearImageButton"
                                Content="❌ Clear"
                                MinHeight="35"
                                FontSize="14"
                                Background="#E1E1E1"
                                Foreground="#000000"
                                BorderThickness="1"
                                BorderBrush="#A0A0A0"
                                Padding="12,0"
                                Cursor="Hand"
                                Click="ClearImageButton_Click"
                                Visibility="Collapsed" />
                        </StackPanel>
                        
                        <!-- Image status and display -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Name="ImageStatusText"
                                FontSize="12"
                                Foreground="#808080"
                                Visibility="Collapsed"
                                Margin="0,0,8,0" />
                        </StackPanel>
                        
                        <Image Name="SelectedImageDisplay"
                            MaxHeight="150"
                            MaxWidth="200"
                            Margin="0,0,0,8"
                            HorizontalAlignment="Left"
                            Visibility="Collapsed" />
                        
                        <!-- Text input and ask button -->
                        <StackPanel Orientation="Horizontal">
                            <!-- TextBox for user input -->
                            <TextBox Name="QuestionTextBox"
                                MinHeight="40"
                                FontSize="16"
                                Padding="10"
                                Background="#FFFFFF"
                                Foreground="#000000"
                                BorderBrush="#808080"
                                BorderThickness="1"
                                VerticalContentAlignment="Center"
                                ToolTip="Type your question here..."
                                KeyDown="QuestionTextBox_KeyDown"
                                Width="260"
                                Margin="0,0,8,0" />
                            <!-- Button to submit the question -->
                            <Button Name="AskButton"
                                Content="Ask"
                                MinHeight="40"
                                FontSize="16"
                                Background="#E1E1E1"
                                Foreground="#000000"
                                BorderThickness="1"
                                BorderBrush="#A0A0A0"
                                Padding="18,0"
                                Cursor="Hand"
                                Click="AskButton_Click"
                                Width="80">
                            </Button>
                        </StackPanel>
                    </StackPanel>
                    <!-- Display area for the question and answer -->
                    <Border Background="#FFFFFF" CornerRadius="0" Padding="16" Grid.Row="2"
                        VerticalAlignment="Stretch" HorizontalAlignment="Stretch" BorderBrush="#808080" BorderThickness="1">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <!-- Displayed question -->
                                <TextBlock Text="Question:" FontWeight="Bold" Foreground="#000000"
                                    Margin="0,0,0,4" FontSize="16" />
                                <TextBox Name="DisplayedQuestionTextBox"
                                    FontSize="15"
                                    Foreground="#000000"
                                    TextWrapping="Wrap"
                                    Margin="0,0,0,12"
                                    IsReadOnly="True"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    IsTabStop="False" />
                                <!-- Displayed answer -->
                                <TextBlock Text="Answer:" FontWeight="Bold" Foreground="#000000"
                                    Margin="0,0,0,4" FontSize="16" />
                                <RichTextBox Name="AnswerRichTextBox"
                                    FontSize="18"
                                    Foreground="#000000"
                                    IsReadOnly="True"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    IsTabStop="False"
                                    VerticalScrollBarVisibility="Auto"
                                    HorizontalScrollBarVisibility="Disabled"
                                    Block.LineHeight="1.2" />
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                    <!-- Spinner overlay for loading state -->
                    <Grid x:Name="SpinnerOverlay" Visibility="Collapsed" Background="#80F0F0F0"
                        Grid.RowSpan="3" Panel.ZIndex="999">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <!-- Rotating spinner -->
                            <Ellipse Width="10" Height="10" Stroke="#000000" StrokeThickness="6">
                                <Ellipse.RenderTransform>
                                    <RotateTransform x:Name="SpinnerRotate" Angle="0" />
                                </Ellipse.RenderTransform>
                                <Ellipse.Triggers>
                                    <EventTrigger RoutedEvent="Loaded">
                                        <BeginStoryboard>
                                            <Storyboard RepeatBehavior="Forever">
                                                <DoubleAnimation
                                                    Storyboard.TargetName="SpinnerRotate"
                                                    Storyboard.TargetProperty="Angle"
                                                    From="0" To="360" Duration="0:0:1" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Ellipse.Triggers>
                            </Ellipse>
                            <!-- Loading message -->
                            <TextBlock Text="Waiting for response..." Foreground="#000000"
                                FontWeight="Bold" FontSize="16" Margin="0,16,0,0"
                                HorizontalAlignment="Center" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>